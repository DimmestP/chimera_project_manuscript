---
title: "RT-qPCR of pRPS3-mCh-tRPS3mod (2 reps) and pPGK1-mCh-tRPS3mod (2 reps)"
author: "Jamie Auxillos"
date: "06/05/2020"
output:
  html_document:
    toc: yes
    #toc_depth: 2
---

```{r setup,warning=FALSE,message=FALSE,echo=FALSE}

## knitr options for report generation
knitr::opts_chunk$set(warning=FALSE,message=FALSE,echo=TRUE,cache=FALSE,
                      #results="show",
                      fig.path="figures/pRPS3_pPGK1_tRPS3mod/")

library(tidyverse)
library(cowplot)
library(tidyqpcr)

 # set default theme for graphics
theme_set(theme_cowplot(font_size=11) %+replace% 
              theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"),
                    panel.border=element_rect(colour = "grey50",linetype = "solid",size=0.5),
                    panel.grid.major = element_line(size = 0.25, linetype = 'solid',colour = "grey"),
                    plot.title = element_text(family="Tahoma",size=11,vjust=3.3),
                    strip.background = element_blank(),
                    strip.text.x=element_text(family="Tahoma",size=9),
                    axis.text=element_text(family="Tahoma", size=10),
                    axis.title=element_text(family="Tahoma", size=10),
                    legend.text=element_text(family="Tahoma", size=8),
                    legend.title=element_text(family="Tahoma", size=9)))
```

```{r label_plates,dependson="plate_functions", echo=FALSE}

# list Targets (Primer sets)
TargetID <- c("mCh-7", "URA3-ORF", "RPS3-ORF", "PGK1-ORF")
TargetIDvalues <-factor(rep(TargetID,levels=TargetID))


# labelling of SampleID attributes
StrainlevelsR3 <- c("pRPS3-mCherry-tRPS3_WT","pRPS3-mCherry-tRPS3_mod0","pRPS3-mCherry-tRPS3_modA","pRPS3-mCherry-tRPS3_modB","pRPS3-mCherry-tRPS3_modC", "pRPS3-mCherry-tRPS3_modD", "pRPS3-mCherry-tRPS3_modE","POT1-ccdB")
StrainvaluesR3 <- factor(rep(StrainlevelsR3,each=3),levels=StrainlevelsR3)
StrainlevelsP1 <- c("pPGK1-mCherry-tRPS3_WT","pPGK1-mCherry-tRPS3_mod0","pPGK1-mCherry-tRPS3_modA","pPGK1-mCherry-tRPS3_modB","pPGK1-mCherry-tRPS3_modC", "pPGK1-mCherry-tRPS3_modD", "pPGK1-mCherry-tRPS3_modE","POT1-ccdB")
StrainvaluesP1 <- factor(rep(StrainlevelsP1,each=3),levels=StrainlevelsP1)
BioReplevels_A <- c("BioRep1","BioRep2","BioRep3")
BioRepvalues_A <- factor(rep(BioReplevels_A,times=8),levels=BioReplevels_A)
BioReplevels_B <- c("BioRep4","BioRep5","BioRep6")
BioRepvalues_B <- factor(rep(BioReplevels_B,times=8),levels=BioReplevels_B)

# Attribute labels to each row and column for each plate (pRPS3 and pPGK1 plates)
colkeyR3_1 <- tibble(WellC=1:24, Strain=StrainvaluesR3, BioRep=BioRepvalues_A) 
colkeyR3_2 <- tibble(WellC=1:24, Strain=StrainvaluesR3, BioRep=BioRepvalues_B) 
colkeyP1_1 <- tibble(WellC=1:24, Strain=StrainvaluesP1, BioRep=BioRepvalues_A) 
colkeyP1_2 <- tibble(WellC=1:24, Strain=StrainvaluesP1, BioRep=BioRepvalues_B) 
rowkey <- create_rowkey_4in16(TargetID=TargetIDvalues) 


# Combine all the information into 4x plate plans
plateplanR3_1 <-     
    label_plate_rowcol(create_blank_plate(WellR = LETTERS[1:16],WellC=1:24),
                       rowkey,colkeyR3_1%>% 
    unite(SampleID,Strain,BioRep,remove=FALSE)%>%
    separate(Strain, remove = FALSE,sep="-",into=c("Promoter","mCherry","Terminator")) %>%
    separate(Terminator, remove = FALSE, sep="_",into=c("Terminator","Construct")) %>%
    mutate(Construct = factor(Construct,levels = c("modE","modD","modC","modB","modA","mod0","WT")),remove = FALSE)%>%
    unite(Pro_mCh,Promoter,mCherry,sep="-", remove=FALSE)%>%
    unite(Ter_mod,Terminator,Construct,sep="_", remove=FALSE))

plateplanR3_2 <-     
    label_plate_rowcol(create_blank_plate(WellR = LETTERS[1:16],WellC=1:24),
                       rowkey,colkeyR3_2%>% 
    unite(SampleID,Strain,BioRep,remove=FALSE)%>%
    separate(Strain, remove = FALSE,sep="-",into=c("Promoter","mCherry","Terminator")) %>%
    separate(Terminator, remove = FALSE, sep="_",into=c("Terminator","Construct")) %>%
    mutate(Construct = factor(Construct,levels = c("modE","modD","modC","modB","modA","mod0","WT")),remove = FALSE)%>%
    unite(Pro_mCh,Promoter,mCherry,sep="-", remove=FALSE)%>%
    unite(Ter_mod,Terminator,Construct,sep="_", remove=FALSE))

plateplanP1_1 <-     
    label_plate_rowcol(create_blank_plate(WellR = LETTERS[1:16],WellC=1:24),
                       rowkey,colkeyP1_1%>% 
    unite(SampleID,Strain,BioRep,remove=FALSE)%>%
    separate(Strain, remove = FALSE,sep="-",into=c("Promoter","mCherry","Terminator")) %>%
    separate(Terminator, remove = FALSE, sep="_",into=c("Terminator","Construct")) %>%
    mutate(Construct = factor(Construct,levels = c("modE","modD","modC","modB","modA","mod0","WT")),remove = FALSE)%>%
    unite(Pro_mCh,Promoter,mCherry,sep="-", remove=FALSE)%>%
    unite(Ter_mod,Terminator,Construct,sep="_", remove=FALSE))

plateplanP1_2 <-     
    label_plate_rowcol(create_blank_plate(WellR = LETTERS[1:16],WellC=1:24),
                       rowkey,colkeyP1_2%>% 
    unite(SampleID,Strain,BioRep,remove=FALSE)%>%
    separate(Strain, remove = FALSE,sep="-",into=c("Promoter","mCherry","Terminator")) %>%
    separate(Terminator, remove = FALSE, sep="_",into=c("Terminator","Construct")) %>%
    mutate(Construct = factor(Construct,levels = c("modE","modD","modC","modB","modA","mod0","WT")),remove = FALSE)%>%
    unite(Pro_mCh,Promoter,mCherry,sep="-", remove=FALSE)%>%
    unite(Ter_mod,Terminator,Construct,sep="_", remove=FALSE))
```

## Load data and attribute sample information
```{r load_plates,dependson="label_plates",results="show"}
# read my plates
platesR3_1 <- read_tsv("data/JA_20200121-pRPS3-tRPS3mod-n1-ct.txt",skip=1) %>%
    mutate(Well=Pos,Cq=Cp,ExpRep = 1,ExpRep=factor(ExpRep)) %>%
    left_join(plateplanR3_1)


platesR3_2 <- read_tsv("data/JA_20200204-pRPS3-tRPS3mod-n2-ct.txt",skip=1) %>%
    mutate(Well=Pos,Cq=Cp,ExpRep = 2,ExpRep=factor(ExpRep)) %>%
    left_join(plateplanR3_2)

platesP1_1 <- read_tsv("data/JA_20200221_pPGK1-tRPS3mod-n1-ct.txt",skip=1) %>%
    mutate(Well=Pos,Cq=Cp,ExpRep = 1, ExpRep=factor(ExpRep)) %>% 
    left_join(plateplanP1_1)

platesP1_2 <- read_tsv("data/JA_20200311-pPGK1-tRPS3mod-n2-ct.txt",skip=1) %>%
    mutate(Well=Pos,Cq=Cp,ExpRep = 2,ExpRep=factor(ExpRep)) %>%
    left_join(plateplanP1_2)

plates <- bind_rows(platesR3_1,platesR3_2,platesP1_1,platesP1_2) 

summary(plates)
```


### Plotting unnormalised data for pRPS3 strains
Here we are plotting the unnormalised qPCR data for the constructs containing pRPS3 driving the expression of mCherry. All -RT samples appear to have high Cq values and all +RT samples have Cq values below 20 cycles. There is however a clear difference in the Cq values between experimental replicates (Experimental replicate 1 -Biorep 1, 2, 3)(Experimental replicate 2 -Biorep 4, 5, 6). Experimental replicate 1 seems to have lower Cq values across all primers and strains than experimental replicate 2.  

The results for modE suggest that there may be a plate position effect for these consecutive runs (BioRep 2 and 5 consistently higher despite no clear differences across other constructs)

```{r unnorm_pRPS3,fig.height=5,fig.width=10, echo=FALSE}
platespRPS3 <- plates%>% filter(Strain %in% c("pRPS3-mCherry-tRPS3_WT","pRPS3-mCherry-tRPS3_mod0","pRPS3-mCherry-tRPS3_modA","pRPS3-mCherry-tRPS3_modB",
                                           "pRPS3-mCherry-tRPS3_modC","pRPS3-mCherry-tRPS3_modD","pRPS3-mCherry-tRPS3_modE"))%>%
  mutate(Strain = factor(Strain,levels=c("pRPS3-mCherry-tRPS3_WT","pRPS3-mCherry-tRPS3_mod0","pRPS3-mCherry-tRPS3_modA","pRPS3-mCherry-tRPS3_modB",
                                           "pRPS3-mCherry-tRPS3_modC","pRPS3-mCherry-tRPS3_modD","pRPS3-mCherry-tRPS3_modE")))

ggplot(data=platespRPS3, aes(x=TargetID,y=Cq)) +
    geom_point(aes(color=BioRep, shape=Type),
               position=position_dodge(width = 0.85),size=1.6, alpha=0.7) +
    labs(y="Quantification cycle (Cq)",x="Primers") +
    scale_shape_manual(values=c(16,23)) +
    scale_colour_hue(h = c(90, 360)+20,l=60,c=60)+
    facet_wrap(~Strain,ncol=4) +
    theme(axis.text.x=element_text(angle=90,vjust=0.5),
          axis.title.x=element_text(vjust=-2),
          axis.title.y=element_text(vjust=3),
          legend.position=c(0.85,0.01))
```


### Plotting unnormalised data for pPGK1 strains
Here we are plotting the unnormalised qPCR data for the constructs containing pPGK1 driving the expression of mCherry. All -RT samples appear to have high Cq values and all +RT samples have Cq values below 20 cycles. **BioRep 2 (of Experimental replicate 1) for the pPGK1-mCherry-tRPS3_WT strain seems to show high Cq values (>20 cycles) across all the probes and technical replicates suggesting a problem with the sample processing. Therefore, in further analysis, the data for this biorep of this strain will be excluded.**  

Variability for WT seems high but taking the median should offset outliers (mostly 2 replicate together and 1 outlier)

```{r unnorm_pPGK1,fig.height=5,fig.width=10, echo=FALSE}

platespPGK1 <- plates%>% filter(Strain %in% c("pPGK1-mCherry-tRPS3_WT","pPGK1-mCherry-tRPS3_mod0","pPGK1-mCherry-tRPS3_modA","pPGK1-mCherry-tRPS3_modB",
                                           "pPGK1-mCherry-tRPS3_modC","pPGK1-mCherry-tRPS3_modD","pPGK1-mCherry-tRPS3_modE"))%>%
  mutate(Strain = factor(Strain,levels=c("pPGK1-mCherry-tRPS3_WT","pPGK1-mCherry-tRPS3_mod0","pPGK1-mCherry-tRPS3_modA","pPGK1-mCherry-tRPS3_modB",
                                           "pPGK1-mCherry-tRPS3_modC","pPGK1-mCherry-tRPS3_modD","pPGK1-mCherry-tRPS3_modE")))
ggplot(data=platespPGK1, aes(x=TargetID,y=Cq)) +
    geom_point(aes(color=BioRep, shape=Type),
               position=position_dodge(width = 0.85),size=1.6, alpha=0.7) +
    labs(y="Quantification cycle (Cq)",x="Primers") +
    scale_shape_manual(values=c(16,23)) +
    scale_colour_hue(h = c(90, 360)+20,l=60,c=60)+
    facet_wrap(~Strain,ncol=4) +
    theme(axis.text.x=element_text(angle=90,vjust=0.5),
          axis.title.x=element_text(vjust=-2),
          axis.title.y=element_text(vjust=3),
          legend.position=c(0.85,0.01))
```


### Plotting unnormalised data for control strains (pRPS3-mCherry-tRPS3_WT and POT1-ccdB)
Here we are plotting the unnormalised qPCR data for the negative control strain (POT1-ccdB - strain containing the backbone plasmid without the mCherry cassette). BioReps 1,2,3 have a low (<20) Cq value for the POT1-ccdB strains with the mCh-7 Probe, which is not good because there is no mCherry target in this strain. As a comparison, I have plotted the pRPS3-mCherry-tRPS3_WT strain (which is positive for the mCherry target).  

As observed in the previous plots, all the Cq vales for Bioreps 1, 2 and 3 (all from Experimental replicate 1) are lower than that of Bioreps 4, 5 and 6 (all from Experimental replicate 2). Interestingly, the difference between Cq value of ExpRep 1 and ExpRep2 are not the same across strains and with different targets (difference in mCh-7 of POT1-ccdB is larger than the rest)

NOTE - the mCherry is having off-target amplification/template contamination, with a very pronounced difference from different days.

```{r unnorm_POT_pRPS3, fig.height=3.5,fig.width=5.5, echo=FALSE}

platesPOT_RPS3 <- bind_rows(platesR3_1,platesR3_2)%>% filter(Strain %in% c("pRPS3-mCherry-tRPS3_WT","POT1-ccdB"))

ggplot(data=platesPOT_RPS3, aes(x=TargetID,y=Cq)) +
  geom_point(aes(color=BioRep, shape=Type),
               position=position_dodge(width = 0.85),size=1.5, alpha=0.7) +
  labs(title="Controls for pRPS3 strains - \n Comparing between experimental replicates",y="Quantification cycle (Cq)",x="Primers") +
  ylim(0,40)+
  scale_shape_manual(values=c(16,23)) +
  scale_colour_hue(h = c(90, 360)+20,l=60,c=60)+
  facet_wrap(~Strain,ncol=2)+
  theme(axis.text.x=element_text(angle=90,vjust=0.5),
          axis.title.x=element_text(vjust=-2),
          axis.title.y=element_text(vjust=3))
```


### Plotting unnormalised data for control strains (pPGK1-mCherry-tRPS3_WT and POT1-ccdB)
Here we are plotting the unnormalised qPCR data for the negative control strain (POT1-ccdB - strain containing the backbone plasmid without the mCherry cassette). Unlike the previous plot showing the control for the pRPS3 experiments, we don't see the same difference between biological replicates in pPGK1 experiments

```{r unnorm_POT_pPGK1, fig.height=3.5,fig.width=5.5, echo=FALSE}

platesPOT_PGK1 <- bind_rows(platesP1_1,platesP1_2)%>% filter(Strain %in% c("pPGK1-mCherry-tRPS3_WT","POT1-ccdB"))

ggplot(data=platesPOT_PGK1, aes(x=TargetID,y=Cq)) +
    geom_point(aes(color=BioRep, shape=Type),
               position=position_dodge(width = 0.85),size=1.5, alpha=0.7) +
  labs(title="Controls for pPGK1 strains - \n Comparing between experimental replicates",y="Quantification cycle (Cq)",x="Primers") +
  ylim(0,40)+
  scale_shape_manual(values=c(16,23)) +
  scale_colour_hue(h = c(90, 360)+20,l=60,c=60)+
  facet_wrap(~Strain,ncol=2)+
  theme(axis.text.x=element_text(angle=90,vjust=0.5),
          axis.title.x=element_text(vjust=-2),
          axis.title.y=element_text(vjust=3))
```

## Loading amplification and melt curve pRPS3 data

```{r load_amp-melt_R3,dependson="label_plates", results="show"}

platecurveR3_1 <- read_tsv("data/JA_20200121-pRPS3-tRPS3mod-n1.txt",skip=2,
                           col_names=c("Well","SID","Program","Segment","Cycle","Time","Temperature","Fluor")) %>%
    debaseline() %>%left_join(plateplanR3_1)%>%
    mutate(ExpRep = 1,ExpRep=factor(ExpRep))

platecurveR3_2 <- read_tsv("data/JA_20200204-pRPS3-tRPS3mod-n2.txt",skip=2,
                           col_names=c("Well","SID","Program","Segment","Cycle","Time","Temperature","Fluor")) %>%
    debaseline() %>%left_join(plateplanR3_2)%>%
    mutate(ExpRep = 2,ExpRep=factor(ExpRep))

platecurveR3 <- bind_rows(platecurveR3_1, platecurveR3_2)

platesampR3  <- platecurveR3 %>% filter(Program == 2)
platesmeltR3 <- platecurveR3 %>% filter(Program != 2) %>% getdRdTall() %>% filter(Temperature >= 61)  
head(platesampR3)
head(platesmeltR3)
```

### Amplification Curves of POT1-ccdB strains (all bioreps) against all 4 TargetIDs (mCh-7, PGK1-ORF, RPS3-ORF, URA3-ORF) (pRPS3)
Here I am comparing the amplification curves of POT1-ccdB strains in pRPS3 experiments between experimental replicates (ExpRep1 in red, ExpRep2 in blue). Looking only at the mCh-7 amplification curves for each BioRep, it seems that BioRep1, 2 and 3 have an early Cq value (reaches exponential phase at an earlier cycle) than BioRep4, 5 and 6. However, across all amplification curves against the mCherry target, the -RT either does not have a fluorecence signal (flat dotted line) or a late Cq value (fluorescence signal at a late cycle). So there doesn't seem to be a problem with samples based on the amplification curves.  

NOTE - shallow curves seems to be related to including a high cDNA volume

```{r plotamp_Rep_R3,fig.width=8,fig.height=6, echo=FALSE}
ggplot(data=platesampR3 %>% filter(Strain==c("POT1-ccdB")),
       aes(x=Cycle,y=Signal,linetype=Type,group=Well, color=ExpRep)) + 
    facet_grid(BioRep~TargetID) + 
    geom_line() +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    expand_limits(y=0) + 
    labs(title="Amplification curves of POT1-ccdB strains (BioRep 1-6) in pRPS3 experiments") + panel_border()

ggplot(data=platesampR3 %>% filter(Strain==c("pRPS3-mCherry-tRPS3_WT")),
       aes(x=Cycle,y=Signal,linetype=Type,group=Well, color=ExpRep)) + 
    facet_grid(BioRep~TargetID) + 
    geom_line() +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    expand_limits(y=0) + 
    labs(title="Amplification curves of pRPS3-mCherry-tRPS3_WT strains (BioRep 1-6) in pRPS3 experiments") + panel_border()
```



### Melt Curves of POT1-ccdB and pRPS3-mCherry-tRPS3_WT strains (all bioreps) against all 4 TargetIDs (mCh-7, PGK1-ORF, RPS3-ORF, URA3-ORF) (pRPS3)
Here I am comparing the melt curves of POT1-ccdB and pRPS3-mCherry-tRPS3_WT strains in pRPS3 experiments between experimental replicates (ExpRep1 in red, ExpRep2 in blue).The melt curves with PGK1-ORF, RPS3-ORF and URA3-ORF probes look fine (with only 1 peak). The melt curves of the pRPS3-mCherry-tRPS3_WT show a peak at ~85C however a peak shows up at ~75C in POT1-ccdB strains which was not in the pRPS3-mCherry-tRPS3_WT strains. Apart from this, everything looks normal.  

```{r plotmelt_Rep_R3,dependson="load_amp",fig.width=8,fig.height=6, echo=FALSE}
ggplot(data=platesmeltR3 %>% filter(Strain==c("POT1-ccdB")),
       aes(x=Temperature,y=dRdT,group=Well)) + 
    facet_grid(BioRep~TargetID) + 
    geom_line(aes(color=ExpRep, linetype=Type)) +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    scale_x_continuous(breaks=seq(60,100,10),minor_breaks=seq(60,100,5)) + 
    labs(title="Melt curves of POT1-ccdB strains (BioRep 1-6) in pRPS3 experiments") + panel_border()

ggplot(data=platesmeltR3 %>% filter(Strain==c("pRPS3-mCherry-tRPS3_WT")),
       aes(x=Temperature,y=dRdT,group=Well)) + 
    facet_grid(BioRep~TargetID) + 
    geom_line(aes(color=ExpRep, linetype=Type)) +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    scale_x_continuous(breaks=seq(60,100,10),minor_breaks=seq(60,100,5)) + 
    labs(title="Melt curves of pRPS3-mCherry-tRPS3_WT strains (BioRep 1-6) in pRPS3 experiments") + panel_border()
```


### Loading amplification and melt curve pPGK1 data

```{r load_amp-melt_P1,dependson="label_plates"}

platecurveP1_1 <- read_tsv("data/JA_20200221_pPGK1-tRPS3mod-n1.txt",skip=2,
                           col_names=c("Well","SID","Program","Segment","Cycle","Time","Temperature","Fluor")) %>%
    debaseline() %>%left_join(plateplanP1_1)%>%
    mutate(ExpRep = 1,ExpRep=factor(ExpRep))

platecurveP1_2 <- read_tsv("data/JA_20200204-pRPS3-tRPS3mod-n2.txt",skip=2,
                           col_names=c("Well","SID","Program","Segment","Cycle","Time","Temperature","Fluor")) %>%
    debaseline() %>%left_join(plateplanP1_2)%>%
    mutate(ExpRep = 2,ExpRep=factor(ExpRep))

platecurveP1 <- bind_rows(platecurveP1_1, platecurveP1_2)

platesampP1  <- platecurveP1 %>% filter(Program == 2)
platesmeltP1 <- platecurveP1 %>% filter(Program != 2) %>% getdRdTall() %>% filter(Temperature >= 61)  
```

### Amplification Curves of POT1-ccdB strains (all bioreps) against all 4 TargetIDs (mCh-7, PGK1-ORF, RPS3-ORF, URA3-ORF) (pPGK1)
Here I am comparing the amplification curves of POT1-ccdB strains in pRPS3 experiments between experimental replicates (ExpRep1 in red, ExpRep2 in blue). Looking only at the mCh-7 amplification curves for each BioRep, it seems that BioRep1, 2 and 3 have an early Cq value (reaches exponential phase at an earlier cycle) than BioRep4, 5 and 6. However, across all amplification curves against the mCherry target, the -RT either does not have a fluorecence signal (flat dotted line) or a late Cq value (fluorescence signal at a late cycle). So there doesn't seem to be a problem with samples based on the amplification curves.  

NOTE - shallow curves seems to be related to including a high cDNA volume (seemed to clear up when I added more RNA to cDNA reaction then used less of the reaction for qPCR)

```{r plotamp_Rep_P1,dependson="load_amp",fig.width=8,fig.height=6, echo=FALSE}
ggplot(data=platesampP1 %>% filter(Strain==c("POT1-ccdB")),
       aes(x=Cycle,y=Signal,linetype=Type,group=Well, color=ExpRep)) + 
    facet_grid(BioRep~TargetID) + 
    geom_line() +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    expand_limits(y=0) + 
    labs(title="Amplification curves of POT1-ccdB strains (BioRep 1-6) in pPGK1 experiments") + panel_border()
```

### Melt Curves of POT1-ccdB and pPGK1-mCherry-tRPS3_WT strains (all bioreps) against all 4 TargetIDs (mCh-7, PGK1-ORF, RPS3-ORF, URA3-ORF) (pPGK1)
Here I am comparing the melt curves of POT1-ccdB and pRPS3-mCherry-tRPS3_WT strains in pRPS3 experiments between experimental replicates (ExpRep1 in red, ExpRep2 in blue).The melt curves with PGK1-ORF, RPS3-ORF and URA3-ORF probes look fine (with only 1 peak). The melt curves of the pRPS3-mCherry-tRPS3_WT show a peak at ~85C however a peak shows up at ~75C in POT1-ccdB strains which was not in the pRPS3-mCherry-tRPS3_WT strains. Apart from this, everything looks normal.  

```{r plotmelt_Rep_P1,fig.width=8,fig.height=6, echo=FALSE}
ggplot(data=platesmeltP1 %>% filter(Strain==c("POT1-ccdB")),
       aes(x=Temperature,y=dRdT,group=Well)) + 
    facet_grid(BioRep~TargetID) + 
    geom_line(aes(color=ExpRep, linetype=Type)) +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    scale_x_continuous(breaks=seq(60,100,10),minor_breaks=seq(60,100,5)) + 
    labs(title="Melt curves of POT1-ccdB strains (BioRep 1-6) in pPGK1 experiments") + panel_border()

ggplot(data=platesmeltP1 %>% filter(Strain==c("pPGK1-mCherry-tRPS3_WT")),
       aes(x=Temperature,y=dRdT,group=Well)) + 
    facet_grid(BioRep~TargetID) + 
    geom_line(aes(color=ExpRep, linetype=Type)) +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    scale_x_continuous(breaks=seq(60,100,10),minor_breaks=seq(60,100,5)) + 
    labs(title="Melt curves of pPGK1-mCherry-tRPS3_WT strains (BioRep 1-6) in pPGK1 experiments") + panel_border()
```

## 1) Delta Cq calculation
Normalisation of mCherry Cq values against PGK1-ORF and RPS3-ORF Cq values. This calculation takes the **median** of normTargetIDs (getNormCq function default is **median**)

```{r deltaCq_norm, echo=TRUE, fig.height=6, fig.width=9}

# platesnorm first excludes pPGK1-mCherry-tRPS3_WT_BioRep2, and all POT1-ccdB strains, then takes all +RT results, then normalises the Cq values by the median of normTargetIDs, then filters Cq values for mCh-7
platesnorm <- plates  %>% 
        filter(!SampleID %in% c("pPGK1-mCherry-tRPS3_WT_BioRep2"), !Strain %in% c("POT1-ccdB"), Type=="+RT") %>%    
        normalizeqPCR(normTargetIDs = c("PGK1-ORF", "RPS3-ORF")) 

platesnorm_summarise <- platesnorm%>%
                    group_by(Strain, TargetID, BioRep, ExpRep)%>%
                    summarize(Median_deltaCq = median(Value.norm, na.rm=TRUE),
                              RNA_Abundance = (2^-Median_deltaCq), na.rm=FALSE)%>% 
    separate(Strain, remove = FALSE,sep="-",into=c("Promoter","mCherry","Terminator")) %>%
    separate(Terminator, remove = FALSE, sep="_",into=c("Terminator","Construct")) %>%
    mutate(Construct = factor(Construct,levels = c("modE","modD","modC","modB","modA","mod0","WT")),remove = FALSE)%>%
    unite(Pro_mCh,Promoter,mCherry,sep="-", remove=FALSE)%>%
    unite(Ter_mod,Terminator,Construct,sep="_", remove=FALSE)



ggplot(platesnorm, aes(Ter_mod,Value.norm))+
  geom_point(aes(color=BioRep),position=position_dodge(width = 0.85),size=1.2, alpha=0.7)+
  scale_colour_hue(h = c(90, 360)+20,l=60,c=60)+
  labs(y="delta Cq", x="3'UTR-terminators")+
  facet_wrap(~TargetID)+
  theme(axis.text.x=element_text(angle=90,vjust=0.5))+
  geom_hline(yintercept = 0, color = "black", linetype= 'dotted', size=1) 
```

### 1) Exporting analysed delta Cq values data
```{r deltaCq_normdata, echo=TRUE}
#exporting platesnorm dataframe
write.csv(platesnorm_summarise,"analysed_data/pRPS3_pPGK1_tRPS3mod/deltaCq_platesnorm_summarise.csv", row.names = FALSE)
```

Plot shows shifted distributions in normalised Cq values for pRPS3 samples between experimental replciates. This shift in distributions between experimental replicates is not seen for pPGK1 samples.
```{r plot_deltaCq, echo=TRUE, fig.height=5, fig.width=9}

ggplot(platesnorm %>% filter(TargetID %in% 'mCh-7'), aes(Ter_mod,Value.norm))+
  geom_point(aes(color=ExpRep),position=position_dodge(width = 0.85),size=1.2, alpha=1)+
  scale_colour_hue(h = c(90, 360)+20,l=60,c=60)+
  labs(y="delta Cq", x="3'UTR-terminators")+
  facet_wrap(~Promoter)+
  theme(axis.text.x=element_text(angle=90,vjust=0.5))+
  geom_hline(yintercept = 0, color = "black", linetype= 'dotted', size=1) 
```

## 2) Delta-delta Cq and RNA abundance calculation (one mod0 mean per ExpRep per promoter)
Normalisation of delta Cq values against tRPS3-mod0 delta Cq values. Strains are first subdivided based on their promoter (either pPGK1 or pRPS3).   

pRPS3-mCherry-tRPS3_mod0 datapoints were divided into two based on ExpRep. From this, two (depending on ExpRep) **Mean Value.norm of pRPS3-mCherry-tRPS3_mod0** were calculated by taking the median Value.norm among TechReps of each BioRep (of pRPS3-mCherry-tRPS3_mod0), then calculating **two** mean Value.norm among BioReps of pRPS3-mCherry-tRPS3_mod0 for each ExpRep. 

pRPS3 datapoints were subdivided based on ExpRep. Delta delta Cq is calculated by subtracting the **Mean Value.norm of pRPS3-mCherry-tRPS3_mod0 of ExpRep1** from each Value.norm of all other strains in ExpRep1. Delta delta Cq is calculated by subtracting the **Mean Value.norm of pRPS3-mCherry-tRPS3_mod0 of ExpRep2** from each Value.norm of all other strains in ExpRep2. (NOTE - we still have one Value.norm for each TechRep and BioRep here). 

**NOTE - Here median is used to summarise/collapse TechReps and mean is used to summarise/collapse BioReps**
```{r delta-deltaCq_norm_RPS3_ExpRep, echo=TRUE}

# Extracts the pRPS3 strains
platesnorm_pRPS3_ExpRep <- platesnorm %>% filter(Promoter %in% "pRPS3", TargetID %in% "mCh-7")
  
# Calculates the mean Cq value of pRPS3-mCherry-tRPS3_mod0 Samples (-0.1133333)
mean_platesnorm_pRPS3mod0_ExpRep1 <- platesnorm_pRPS3_ExpRep  %>% filter(ExpRep==1)%>%
    select(c("Strain","Value.norm", "BioRep", "TechRep")) %>% 
    filter(Strain %in% c("pRPS3-mCherry-tRPS3_mod0")) %>%
    group_by(Strain, BioRep)%>%
    summarize(median_BioRep_mod0 = median(Value.norm)) %>%
    ungroup()%>%
    group_by(Strain)%>%
    summarize(mean_mod0 = mean(median_BioRep_mod0))

# Calculates the mean Cq value of pRPS3-mCherry-tRPS3_mod0 Samples (-1.236667)
mean_platesnorm_pRPS3mod0_ExpRep2 <- platesnorm_pRPS3_ExpRep  %>% filter(ExpRep==2)%>%
    select(c("Strain","Value.norm", "BioRep", "TechRep")) %>% 
    filter(Strain %in% c("pRPS3-mCherry-tRPS3_mod0")) %>%
    group_by(Strain, BioRep)%>%
    summarize(median_BioRep_mod0 = median(Value.norm)) %>%
    ungroup()%>%
    group_by(Strain)%>%
    summarize(mean_mod0 = mean(median_BioRep_mod0))

# Calculates the delta delta Cq (subtracts mean(pRPS3mod0$Value.norm) from every Value.norm))
platesnorm_mod0_pRPS3_ExpRep1 <- platesnorm_pRPS3_ExpRep %>% filter(ExpRep==1)%>%
    mutate(Value.norm.mod0 = Value.norm - mean_platesnorm_pRPS3mod0_ExpRep1$mean_mod0, remove=FALSE)
platesnorm_mod0_pRPS3_ExpRep2 <- platesnorm_pRPS3_ExpRep %>% filter(ExpRep==2)%>%
    mutate(Value.norm.mod0 = Value.norm - mean_platesnorm_pRPS3mod0_ExpRep2$mean_mod0, remove=FALSE)
```

pPGK1-mCherry-tRPS3_mod0 datapoints were divided into two based on ExpRep. From this, two (depending on ExpRep) **Mean Value.norm of pPGK1-mCherry-tRPS3_mod0** were calculated by taking the median Value.norm among TechReps of each BioRep (of pPGK1-mCherry-tRPS3_mod0), then calculating **two** mean Value.norm among BioReps of pPGK1-mCherry-tRPS3_mod0 for each ExpRep. 

pPGK1 datapoints were subdivided based on ExpRep. Delta delta Cq is calculated by subtracting the **Mean Value.norm of pPGK1-mCherry-tRPS3_mod0 of ExpRep1** from each Value.norm of all other strains in ExpRep1. Delta delta Cq is calculated by subtracting the **Mean Value.norm of pPGK1-mCherry-tRPS3_mod0 of ExpRep2** from each Value.norm of all other strains in ExpRep2. (NOTE - we still have one Value.norm for each TechRep and BioRep here). 

**NOTE - Here median is used to summarise/collapse TechReps and mean is used to summarise/collapse BioReps**

```{r delta-deltaCq_norm_PGK1_ExpRep, echo=TRUE}

# Extracts the pRPS3 strains
platesnorm_pPGK1_ExpRep <- platesnorm %>% filter(Promoter %in% "pPGK1", TargetID %in% "mCh-7")
  
# Calculates the mean Cq value of pPGK1-mCherry-tRPS3_mod0 Samples (-2.158333)
mean_platesnorm_pPGK1mod0_ExpRep1 <- platesnorm_pPGK1_ExpRep  %>% filter(ExpRep==1)%>%
    select(c("Strain","Value.norm", "BioRep", "TechRep")) %>% 
    filter(Strain %in% c("pPGK1-mCherry-tRPS3_mod0")) %>%
    group_by(Strain, BioRep)%>%
    summarize(median_BioRep_mod0 = median(Value.norm)) %>%
    ungroup()%>%
    group_by(Strain)%>%
    summarize(mean_mod0 = mean(median_BioRep_mod0))

# Calculates the mean Cq value of pPGK1-mCherry-tRPS3_mod0 Samples (-2.136667)
mean_platesnorm_pPGK1mod0_ExpRep2 <- platesnorm_pPGK1_ExpRep  %>% filter(ExpRep==2)%>%
    select(c("Strain","Value.norm", "BioRep", "TechRep")) %>% 
    filter(Strain %in% c("pPGK1-mCherry-tRPS3_mod0")) %>%
    group_by(Strain, BioRep)%>%
    summarize(median_BioRep_mod0 = median(Value.norm)) %>%
    ungroup()%>%
    group_by(Strain)%>%
    summarize(mean_mod0 = mean(median_BioRep_mod0))

# Calculates the delta delta Cq (subtracts mean(pPGK1mod0$Value.norm) from every Value.norm))
platesnorm_mod0_pPGK1_ExpRep1 <- platesnorm_pPGK1_ExpRep %>% filter(ExpRep==1)%>%
    mutate(Value.norm.mod0 = Value.norm - mean_platesnorm_pPGK1mod0_ExpRep1$mean_mod0, remove=FALSE)
platesnorm_mod0_pPGK1_ExpRep2 <- platesnorm_pPGK1_ExpRep %>% filter(ExpRep==2)%>%
    mutate(Value.norm.mod0 = Value.norm - mean_platesnorm_pPGK1mod0_ExpRep2$mean_mod0, remove=FALSE)
```

## 2) Mean delta delta Cq and RNA abundance calculation
In the previous 2 chunks, we have calculated the delta-delta Cq value for each techrep. Here, we are summarising that information by calculating the median Cq for each biorep and calculating the RNA abundance (2^-Median_Cq).  

```{r mean_rna_abund_ExpRep, echo=TRUE}

# Combining the calculated delta-delta Cq from the two dataframes then calculating the Median delta-delta Cq. RNA abundance is calculated by the following formula 2^(- Median_Cq). 
platesnorm_mod0_median_ExpRep <- bind_rows(platesnorm_mod0_pRPS3_ExpRep1, platesnorm_mod0_pRPS3_ExpRep2, platesnorm_mod0_pPGK1_ExpRep1, platesnorm_mod0_pPGK1_ExpRep2)%>%
                    group_by(Strain, TargetID, BioRep, ExpRep)%>%
                    summarize(Median_Cq = median(Value.norm.mod0, na.rm=TRUE),
                              RNA_Abundance = (2^-Median_Cq), na.rm=FALSE)%>%
                    separate(Strain, remove = FALSE,sep="-",into=c("Promoter","mCherry","Terminator")) %>%
                    separate(Terminator, remove = FALSE, sep="_",into=c("Terminator","Construct")) %>%
                    mutate(Construct = factor(Construct,levels = c("modE","modD","modC","modB","modA","mod0","WT")),remove = FALSE)%>%
                    unite(Pro_mCh,Promoter,mCherry,sep="-", remove=FALSE)%>%
                    unite(Ter_mod,Terminator,Construct,sep="_", remove=FALSE) %>%
                    mutate(Pro_mCh = factor(Pro_mCh,levels = c("pRPS3-mCherry","pPGK1-mCherry"))) %>% 
                    mutate(Ter_mod = factor(Ter_mod,levels=c("tRPS3_modC","tRPS3_modE","tRPS3_modD","tRPS3_modA",
                                           "tRPS3_modB","tRPS3_mod0","tRPS3_WT")))
```

### 2) Plotting the results in a scatter plot

```{r plot_delta_deltaCq_ExpRep_1,fig.height=5,fig.width=9, echo=FALSE}

normalised_plot_ExpRep <- ggplot(data = platesnorm_mod0_median_ExpRep %>% 
    filter(!Strain %in% c("pPGK1-mCherry-tRPS3_WT","pRPS3-mCherry-tRPS3_WT")))+
    geom_point(aes(RNA_Abundance,Ter_mod,colour=Ter_mod, shape=BioRep)) +
    #scale_x_log2nice(name="Fold change in RNA abundance relative to tRPS3-mod0 (log2 scale)",omag = seq(-5,5),scilabels=TRUE) +
    scale_x_log2nice(name="Fold change in RNA abundance relative to tRPS3-mod0 (log2 scale)",omag = seq(-5,5),scilabels=FALSE) +
      labs(y="") +
    scale_shape_manual(values=c(19, 17, 15, 10, 7, 14)) +
    scale_colour_manual(values=c("#288a2e","#a84a9a","#6f3ba1","#416db0","#CC6666","black")) +
    guides(colour=FALSE) +
    theme(axis.text.y=element_text(colour=c("#288a2e","#a84a9a","#6f3ba1","#416db0","#CC6666","black")),
          axis.text.x=element_text(angle=0,vjust=0.5),
          axis.title.x=element_text(vjust=-2),
          legend.position="bottom",
          legend.box.margin=margin(20,10,10,180))+
  facet_wrap(~Pro_mCh,ncol = 2)

normalised_plot_ExpRep + stat_summary(aes(RNA_Abundance,Ter_mod),
    fun="mean",colour="black",
    geom="crossbar",size=0.2, width=0.5) 
```

```{r plot_delta_deltaCq_ExpRep_2,fig.height=9,fig.width=5, echo=FALSE}

normalised_plot1_ExpRep <- ggplot(data = platesnorm_mod0_median_ExpRep %>% 
    filter(!Strain %in% c("pPGK1-mCherry-tRPS3_WT","pRPS3-mCherry-tRPS3_WT")))+
    geom_point(aes(RNA_Abundance,Ter_mod,colour=Ter_mod, shape=BioRep)) +
    scale_x_log2nice(name="Fold change in RNA abundance relative to tRPS3-mod0 \n (log2 scale)",omag = seq(-5,5),scilabels=FALSE) +
    labs(y="") +
    scale_shape_manual(values=c(19, 17, 15, 10, 7, 14)) +
    scale_colour_manual(values=c("#288a2e","#a84a9a","#6f3ba1","#416db0","#CC6666","black")) +
    guides(colour=FALSE) +
    theme(axis.text.y=element_text(colour=c("#288a2e","#a84a9a","#6f3ba1","#416db0","#CC6666","black")),
          axis.text.x=element_text(angle=0,vjust=0.5),
          axis.title.x=element_text(size=10,vjust=-2),
          legend.position="bottom",
          legend.box.margin=margin(20,0,0,30))+
    facet_wrap(~Pro_mCh,nrow = 2)

normalised_plot1_ExpRep + stat_summary(aes(RNA_Abundance,Ter_mod),
    fun="mean",colour="black",
    geom="crossbar",size=0.2, width=0.5) 
```
