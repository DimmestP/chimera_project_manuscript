---
title: "RT-qPCR of pPGK1-mCh-tRPS3mod experimental replicate 1 (n=1)"
author: "Jamie Auxillos"
date: "21/02/2020"
output:
  html_document:
    toc: true
    toc_depth: 2
---

#Plan
Here, we are testing the impact of sequence motifs inserted into the 3'UTR on mRNA stability. RT-qPCR is used to measure the mRNA abundance of mCherry in each strain. The strains tested in this experiments contain a plasmid with an mCherrry cassette driven by pPGK1 and tRPS3, however the 3'UTRs are modified to incorporate different stability or decay motifs. 

#Experimental information
The strains used here are pPGK1-mCherry-tRPS3 wild type (WT), pPGK1-mCherry-tRPS3 mod0 (mod0), pPGK1-mCherry-tRPS3 modA (modA), pPGK1-mCherry-tRPS3 modB (modB), pPGK1-mCherry-tRPS3 modC (modC), pPGK1-mCherry-tRPS3 modD (modD), pPGK1-mCherry-tRPS3 modE (modE), POT1-ccdb. For each strain, three biological replicates were grown. Strains were grown overnight to saturation in a deep well plate (200 ul) in a shaking incubator set at 250 rpm and at 30C. The next day, the OD600 of these cultures were measured and diluted down to an OD600 of 0.2 in an 8 ml culture in a 12 column deep well plate. The samples were grown to an OD600 of 0.5-0.6 for ~3-4 hours. 5 mls of the culture were harvested by centrifugation (3500 rpm for 3 minutes) in a 15 ml falcon tube. The cells were lysed and the RNA was extracted using the following RNA extraction protocol https://www.protocols.io/view/column-based-zymo-rna-extraction-bbcgiitw. The RNA was treated with DNase and used as the template for reverse transcription and qPCR using the following protocol https://github.com/ewallace/protocols/blob/master/RTqPCR_Agilent_Lightcycler_Protocol.md. We are using the probes mCh-7, URA3-ORF, RPS3-ORF and PGK1-ORF for the qPCR experiment. For each RNA sample, we have three technical replicates.

```{r setup,warning=FALSE,message=FALSE,echo=FALSE}

## knitr options for report generation
knitr::opts_chunk$set(warning=FALSE,message=FALSE,echo=TRUE,cache=FALSE,
                      results="show",
                      fig.path="figures/analyse-qPCR-2020-01-23_pPGK1-tRPS3mod",
                      cache.path="cache/analyse-qPCR-2020-01-23_pPGK1-tRPS3mod")

library(tidyverse)
library(cowplot)
library(tidyqpcr)

 # set default theme for graphics
theme_set(theme_cowplot(font_size=11) %+replace% 
              theme(panel.border=element_rect(colour = "grey50",
                                            linetype = "solid",size=0.5),
                    strip.background = element_blank()))
```



## Plate plan
```{r label_plates,dependson="plate_functions"}

# list Targets /Probes
Probes <- c("mCh-7", "URA3-ORF", "RPS3-ORF", "PGK1-ORF")
Probesvalues <-factor(rep(Probes,levels=Probes))

Strainlevels <- c("pPGK1-tRPS3_WT","pPGK1-tRPS3_mod0","pPGK1-tRPS3_modA","pPGK1-tRPS3_modB","pPGK1-tRPS3_modC", "pPGK1-tRPS3_modD", "pPGK1-tRPS3_modE","POT1-ccdB")
Strainvalues <- factor(rep(Strainlevels,each=3),levels=Strainlevels)

BioReplevels <- c("BioRep1","BioRep2","BioRep3")
BioRepvalues <- factor(rep(BioReplevels,times=8),levels=BioReplevels)

colkey <- tibble(WellC=1:24,
                 Sample=Strainvalues,
                 BioRep=BioRepvalues) 
rowkey <- create_rowkey_4in16(Probe=Probesvalues) 

plateplan <-     
    label_plate_rowcol(create_blank_plate(WellR = LETTERS[1:16],WellC=1:24),
                       rowkey,colkey)
```


```{r display_plates,fig.height=18,fig.width=30,dependson="label_plates"}
display_plate( plateplan %>%
    mutate(Sample=Sample,BioRep) )
```


## Load plate and summarrise informatiion
Here, only one experimental replicate is loaded (n=1)
```{r load_plates,dependson="label_plates",results="show"}
# read my plates
plates <- read_tsv( "data/JA_20200221_pPGK1-tRPS3mod-n1-ct.txt",skip=1) %>%
    mutate(Well=Pos,Ct=Cp) %>%
    left_join(plateplan)
summary(plates)
```

# Plotting the unnormalized data
**Something is wrong with pPGK1-mCh-tRPS3_WT BioRep2, the CT values for all 4 targets in the +RT seem too high (~same level as the -RT). This is the case for all the techncial replciates too.

For the rest of the data points, all -RT controls have a high CT value and all +RT reactions have a low CT value. All BioRep and techrep for each strain (+RT) seems tight.
```{r plot_unnormalized,dependson="load_plates",fig.height=14,fig.width=8}
ggplot(data=plates) +
    geom_point(aes(x=Probe,y=Ct,colour=BioRep),
               position=position_jitter(width = 0.2,height=0)) +
    labs(y="Cycle count to threshold",
         title="All reps, unnormalized") +
    scale_shape_manual(values=c(15:18,5:6)) + 
    facet_grid(Sample~Type) +
    theme(axis.text.x=element_text(angle=90,vjust=0.5),
          panel.border=element_rect(fill = NA,linetype=1,
                                    colour = "grey50",size=0.5))
```


## Normalize Ct to PGK1, within Sample only 
Here, i'm normalising the CT values of the mCh-7 probe by the detection by PGK1-ORF.
```{r normalize_counts,dependson="load_plates"}
platesnorm <- plates %>% 
    filter(Type=="+RT") %>%
    normalizeqPCR(normProbes = "PGK1-ORF") %>%
    mutate(Sample = fct_relevel(Sample, 
            "pPGK1-tRPS3_modC", 
            "pPGK1-tRPS3_modE", 
            "pPGK1-tRPS3_modD", 
            "pPGK1-tRPS3_modA", 
            "pPGK1-tRPS3_modB", 
            "pPGK1-tRPS3_mod0", 
            "pPGK1-tRPS3_WT", 
            "POT1-ccdB"))%>%
filter(Probe=="mCh-7")

platesmed <- platesnorm %>%
      mutate(Sample = fct_relevel(Sample, 
            "pPGK1-tRPS3_modC", 
            "pPGK1-tRPS3_modE", 
            "pPGK1-tRPS3_modD", 
            "pPGK1-tRPS3_modA", 
            "pPGK1-tRPS3_modB", 
            "pPGK1-tRPS3_mod0", 
            "pPGK1-tRPS3_WT", 
            "POT1-ccdB"))%>%
      group_by(Sample,Probe,BioRep) %>%
filter(Probe=="mCh-7")%>%
    summarize(Ct=median(Value.norm,na.rm=TRUE),
              Abund=median(Value.normexp,na.rm=TRUE))
filter(platesmed,Probe=="PGK1-ORF")
```

## Plotting all the normalised (to PGK1-ORF) Ct values for all biological replicates and technical replicates for each strain
Biorep 2 of pPGK1-mCh-tRPS3_WT matches the normalised CT values for the negative control straini (POT1-ccdB)
```{r plot_normalized,dependson="normalize_counts",fig.height=3,fig.width=6}
ggplot(data=platesnorm) +
    geom_point(aes(x=Value.norm,y=Sample, colour=BioRep),
               position=position_jitter(width = 0.2,height=0)) +
    labs(x="Ct relative to PGK1") +
    scale_shape_manual(values=c(15:18,5:6)) + 
    facet_grid(Probe~.) +
    theme(axis.text.x=element_text(angle=90,vjust=0.5),
          panel.grid.major = element_line(colour = "grey50",size=0.125))
```


## Plottting the mCherry mRNA detected in each strain (for biological replicates only)

-biorep 1 of modA mRNA abundance seems very high. Pipetting error? (look into the techreps)

-compared to pRPS3-mCh-tRPS3 modA, D and E, where the mRNA abundance is proportional to the number of incorporated motifs (modA-contains one decay motif, modD-contains two decay motifs, modE-contains three decay motifs), here, we dont see that. There is a higher mRNA abundance in modA and modE than in modD.

Same as pRPS3-mCh-tRPS3 datasets,
-There doesn't seem to be much difference between WT and mod0
-There isn't an increase in mRNA abundance in the 3'UTR with an incorporated putative stability motif
```{r plot_normalizedsummarized1,dependson="normalize_counts",fig.height=3,fig.width=6}
ggplot(data=platesmed) +
    geom_point(aes(x=Abund,y=Sample,colour=BioRep),
               position=position_jitter(width = 0.2,height=0)) +
    scale_shape_manual(values=c(15:18,5:6)) + 
    scale_x_log10nice("Relative mRNA detected") + 
  xlim(0.1, 10)+
    theme(axis.text.x=element_text(angle=90,vjust=0.5),
         panel.grid.major = element_line(colour = "grey50",size=0.125))
```


##For plotting the melt curves and amplification curves
```{r load_amp,dependson="label_plates",results="show"}

platecurve <- read_tsv("data/JA_20200221_pPGK1-tRPS3mod-n1.txt",
                       skip=2,
                        col_names=c("Well","SID","Program","Segment",
                                    "Cycle","Time","Temperature","Fluor") 
                      ) %>%
    debaseline() %>%
    left_join(plateplan) %>%
    mutate(BiolRep=1,Plate=1)
platecurve

platesamp  <- platecurve %>% filter(Program == 2)

platesamp <- bind_rows(platecurve,platecurve) %>% 
    filter(Program == 2)

platesmelt <- bind_rows(platecurve,platecurve) %>% 
    filter(Program != 2) %>% 
    getdRdTall() %>% 
    filter(Temperature >= 61)  
```

## Melt Curves of BioRep 1 samples
-RT seems to have a peak in in all the melt curves
```{r plotmelt_Rep1,dependson="load_amp",fig.width=8,fig.height=13}
ggplot(data=platesmelt %>% 
           filter(TechRep==1,BiolRep==1),
       aes(x=Temperature,y=dRdT,colour=Type,group=Well)) + 
    facet_grid(Sample~Probe) + 
    geom_line() +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    scale_x_continuous(breaks=seq(60,100,10),minor_breaks=seq(60,100,5)) + 
    labs(title="Melt curves, BiolRep 1, Techrep 1") + panel_border()
```


## Amplification Curves of BioRep 1 samples

```{r plotamp_Rep1,dependson="load_amp",fig.width=8,fig.height=13}
ggplot(data=platesamp %>% 
           filter(TechRep==1,BiolRep==1),
       aes(x=Cycle,y=Signal,colour=Type,group=Well)) + 
    facet_grid(Sample~Probe) + 
    geom_line() +
    scale_linetype_manual(values=c("-RT"="dashed","+RT"="solid")) +
    expand_limits(y=0) + 
    labs(title="Amp. curves, BiolRep 1, Techrep 1") + panel_border()
```


##Moving forward
-a second experimental needs to be done to confirm this result

-verify strain identity forr modA, D and E. Is it possible that the strains are swapped? (verify by PCR of the cDNA then sequencing)